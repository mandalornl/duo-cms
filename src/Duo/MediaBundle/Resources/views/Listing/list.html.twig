{% extends '@DuoAdmin/Listing/list.html.twig' %}

{% block content %}
	{% import '@DuoMedia/Marco/srcset.html.twig' as media %}

	{% if paginator.canPaginate() %}
		<div class="listing-pagination">
			{{ paginator_widget(paginator, path(routePrefix ~ '_index')) }}
		</div>
	{% endif %}

	{% set checkboxId = random() %}
	<form action="javascript:;" method="post" class="listing-index-form">
		<div class="d-flex justify-content-end mb-3">
			<div class="btn-group" role="group" aria-label="{{ 'duo.media.listing.view.switch' | trans }}">
				<a href="{{ path(app.request.attributes.get('_route'), app.request.attributes.get('_route_params') | merge({ view: 'list' })) }}" class="btn btn-white{% if list.view == 'list' %} active{% endif %}" title="{{ 'duo.media.listing.view.list' | trans }}">
					<i class="icon-list"></i>
				</a>
				<a href="{{ path(app.request.attributes.get('_route'), app.request.attributes.get('_route_params') | merge({ view: 'grid' })) }}" class="btn btn-white{% if list.view == 'grid' %} active{% endif %}" title="{{ 'duo.media.listing.view.grid' | trans }}">
					<i class="icon-image"></i>
				</a>
			</div>
		</div>
		{% if list.view == 'grid' %}
			<div class="row">
				{% for entity in paginator.result %}
					<div class="d-flex flex-column col-6 col-sm-4 col-lg-3">
						<div class="media-thumbnail">
							<input type="checkbox" id="{{ checkboxId }}_{{ entity.id }}" name="ids[]" value="{{ entity.id }}">
							<label for="{{ checkboxId }}_{{ entity.id }}" title="{{ entity.name }}">
								<span class="img-center">
									<img src="{{ entity.url | imagine_filter('srcset_680') }}" srcset="{{ media.srcset(entity.url, [680, 768]) }}" sizes="(min-width: 992px) 25vw, (min-width: 576px) 33.33333vw, 50vw">
								</span>
								<span class="label">
									<span class="filename">{{ entity.name }}</span>
									<span class="actions">
										<a href="{{ entity.url }}" download="{{ entity.name }}" target="_blank" title="{{ 'duo.media.listing.action.download' | trans }}">
											<i class="icon-download"></i>
										</a>
										<a href="{{ path(routePrefix ~ '_update', { id: entity. id }) }}" title="{{ 'duo.media.listing.action.edit' | trans }}">
											<i class="icon-pencil"></i>
										</a>
										{% if list.isDeletable | default(false) %}
											{% set url = path(routePrefix ~ '_delete', { id: entity.id }) %}
										{% else %}
											{% set url = path(routePrefix ~ '_destroy', { id: entity.id }) %}
										{% endif %}
										<a href="{{ url }}" data-modal="delete" title="{{ 'duo.admin.listing.action.delete' | trans }}">
											<i class="icon-bin"></i>
										</a>
									</span>
								</span>
							</label>
						</div>
					</div>
				{% endfor %}
			</div>
		{% else %}
			<div class="table-responsive">
				<table class="table table-hover table-striped listing-table checkable">
					<thead>
					<tr>
						<th>
							<div class="custom-control custom-checkbox">
								<input type="checkbox" id="{{ checkboxId }}_all" class="custom-control-input"{% if not paginator.count %} disabled{% endif %}>
								<label for="{{ checkboxId }}_all" class="custom-control-label"></label>
							</div>
						</th>
							{% for field in list.fields %}
								<th{% if field.sortable %} class="sortable"{% endif %}>
									{% if field.sortable %}
										{% if list.sorting and list.sorting.sort == field.property %}
											{% set url = path(routePrefix ~ '_sorting', { sort: field.property, order: list.sorting.order == 'asc' ? 'desc' : 'asc' }) %}
										{% else %}
											{% set url = path(routePrefix ~ '_sorting', { sort: field.property }) %}
										{% endif %}
										<a href="{{ url }}">
											{{- field.label | trans }}{% if list.sorting and list.sorting.sort == field.property %} <i class="icon-sort-{{ list.sorting.order }}"></i>{% endif %}
										</a>
									{% else %}
										{{- field.label | trans -}}
									{% endif %}
								</th>
							{% endfor %}
						<th>&nbsp;</th>
					</tr>
					</thead>
					<tbody>
						{% for entity in paginator.result %}
							<tr data-url="{{ path(routePrefix ~ '_update', { id: entity.id }) }}">
								<td>
									<div class="custom-control custom-checkbox">
										<input type="checkbox" id="{{ checkboxId }}_{{ entity.id }}" name="ids[]" value="{{ entity.id }}" class="custom-control-input">
										<label for="{{ checkboxId }}_{{ entity.id }}" class="custom-control-label"></label>
									</div>
								</td>
								{% for field in list.fields %}
									<td>
										{%- if field.template -%}
											{%- include field.template -%}
										{%- else -%}
											{%- include '@DuoAdmin/Listing/Field/default.html.twig' -%}
										{%- endif -%}
									</td>
								{% endfor %}
								<td>
									{% if list.isSortable | default(false) and not entity is treeable %}
										<a href="{{ path(routePrefix ~ '_move_up', { id: entity.id }) }}" title="{{ 'duo.admin.listing.action.move_up' | trans }}">
											<i class="icon-arrow-up"></i>
										</a>
										<a href="{{ path(routePrefix ~ '_move_down', { id: entity.id }) }}" title="{{ 'duo.admin.listing.action.move_down' | trans }}">
											<i class="icon-arrow-down"></i>
										</a>
									{% endif %}
									{% if list.isDeletable | default(false) %}
										{% set url = path(routePrefix ~ '_delete', { id: entity.id }) %}
									{% else %}
										{% set url = path(routePrefix ~ '_destroy', { id: entity.id }) %}
									{% endif %}
									<a href="{{ url }}" data-modal="delete" title="{{ 'duo.admin.listing.action.delete' | trans }}">
										<i class="icon-bin"></i>
									</a>
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		{% endif %}
	</form>

	{% if paginator.canPaginate() and paginator.result | length >= paginator.limit %}
		<div class="listing-pagination">
			{{ paginator_widget(paginator, path(routePrefix ~ '_index')) }}
		</div>
	{% endif %}
{% endblock %}